{"ast":null,"code":"var _jsxFileName = \"/home/rachmat/Documents/Emtres/bapenda-pajak/src/authentication/auth-methods/jwt-auth/index.js\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState, useRef } from 'react';\nimport { httpClient } from \"../../../util/Api\";\nimport { useHistory } from \"react-router-dom\";\nimport jwtDecode from \"jwt-decode\";\nimport { USER_LOADED, AUTH_ERROR, LOGIN_SUCCESS, LOGIN_FAIL, LOGOUT, CLEAR_ERROR } from \"../../types\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const useProvideAuth = () => {\n  _s();\n\n  const [authUser, setAuthUser] = useState(null);\n  const [error, setError] = useState('');\n  const [isLoadingUser, setLoadingUser] = useState(true);\n  const [isLoading, setLoading] = useState(false); // const [dataAuth, setDataAuth] = useState()\n  // const nRef = useRef(dataAuth);\n\n  const history = useHistory(); // console.log(\"authUser\",authUser )\n  // useEffect(() => { \n  //   nRef.current = dataAuth \n  // }, \n  //  [dataAuth]\n  //  ) \n  // console.log(\"nRef\",nRef)\n\n  const fetchStart = () => {\n    setLoading(true);\n    setError('');\n  };\n\n  const fetchSuccess = () => {\n    setLoading(false);\n    setError('');\n  };\n\n  const fetchError = error => {\n    setLoading(false);\n    setError(error);\n  };\n\n  const userLogin = (user, callbackFun) => {\n    // console.log(\"user\", user)\n    // setDataAuth(user)\n    fetchStart();\n    httpClient.get('login?username=' + user.username + '&password=' + user.password, user).then(_ref => {\n      let {\n        data\n      } = _ref;\n\n      if (data) {\n        fetchSuccess();\n        httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + data.access_token;\n        localStorage.setItem('token', data.access_token);\n        getAuthUser();\n        if (callbackFun) callbackFun();\n      } else {\n        fetchError(data.error);\n      } //  console.log(\"data.result\",data)\n\n    }).catch(function (error) {\n      // fetchError(error.message);\n      fetchError(\"Username / Password Salah\");\n    });\n  };\n\n  const userSignup = (user, callbackFun) => {\n    fetchStart();\n    httpClient.post('auth/register', user).then(_ref2 => {\n      let {\n        data\n      } = _ref2;\n\n      if (data) {\n        fetchSuccess();\n        localStorage.setItem('token', data.access_token);\n        httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + data.access_token;\n        getAuthUser();\n        if (callbackFun) callbackFun();\n      } else {\n        fetchError(data.error);\n      }\n    }).catch(function (error) {\n      fetchError(error.message);\n    });\n  };\n\n  const sendPasswordResetEmail = (username, callbackFun) => {\n    fetchStart();\n    setTimeout(() => {\n      fetchSuccess();\n      if (callbackFun) callbackFun();\n    }, 300);\n  };\n\n  const confirmPasswordReset = (code, password, callbackFun) => {\n    fetchStart();\n    setTimeout(() => {\n      fetchSuccess();\n      if (callbackFun) callbackFun();\n    }, 300);\n  };\n\n  const renderSocialMediaLogin = () => null;\n\n  const userSignOut = callbackFun => {\n    // const decoded = jwtDecode(localStorage.token);\n    // if (decoded.exp < Date.now() / 1000) {\n    //   // return dispatch({ type: AUTH_ERROR });\n    //   // console.log(\"dispatch\", AUTH_ERROR)\n    // }\n    fetchStart();\n    httpClient.get('/logout').then(_ref3 => {\n      let {\n        data\n      } = _ref3;\n\n      if (data) {\n        fetchSuccess();\n        httpClient.defaults.headers.common['Authorization'] = '';\n        localStorage.removeItem('token');\n        setAuthUser(false);\n        if (callbackFun) callbackFun();\n      } else {\n        fetchError(data.error);\n      } // console.log(\"data logout 0000000000000000000\", data)\n\n    }).catch(function (error) {\n      fetchError(error.message);\n    }); // history.push('/signin')\n  };\n\n  const getAuthUser = () => {\n    fetchStart();\n    httpClient.get('/user').then(_ref4 => {\n      let {\n        data\n      } = _ref4;\n\n      if (data) {\n        fetchSuccess();\n        setAuthUser(data);\n      } else {\n        fetchError(data.error);\n      } // console.log(\"data user\", data)\n\n    }).catch(function (error) {\n      httpClient.defaults.headers.common['Authorization'] = '';\n      fetchError(error.message);\n    });\n  }; // Subscribe to user on mount\n  // Because this sets state in the callback it will cause any ...\n  // ... component that utilizes this hook to re-render with the ...\n  // ... latest auth object.\n\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    console.log(\"token\", token);\n\n    if (token) {\n      httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + token;\n    } else if (token === null) {\n      // localStorage.setItem('auth-token', '');\n      // token = '';\n      // setAuthUser(false);\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"Halaman Tidak ada\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 15\n      }, this);\n    }\n\n    httpClient // .get('login?username=' + nRef.username + '&password=' + nRef.password, nRef)\n    .get('/user').then(_ref5 => {\n      let {\n        data\n      } = _ref5;\n\n      if (data) {\n        setAuthUser(data);\n      }\n\n      setLoadingUser(false);\n      console.log(\"data user USEEFFECT\", data);\n    }).catch(function () {\n      localStorage.removeItem('token');\n      httpClient.defaults.headers.common['Authorization'] = '';\n      setLoadingUser(false);\n    });\n  }, []); // Return the user object and auth methods\n\n  return {\n    isLoadingUser,\n    isLoading,\n    authUser,\n    error,\n    setError,\n    setAuthUser,\n    getAuthUser,\n    userLogin,\n    userSignup,\n    userSignOut,\n    renderSocialMediaLogin,\n    sendPasswordResetEmail,\n    confirmPasswordReset\n  };\n};\n\n_s(useProvideAuth, \"nVDatKDm3l5vk6aERBHBAT2zxBg=\", false, function () {\n  return [useHistory];\n});","map":{"version":3,"sources":["/home/rachmat/Documents/Emtres/bapenda-pajak/src/authentication/auth-methods/jwt-auth/index.js"],"names":["useEffect","useState","useRef","httpClient","useHistory","jwtDecode","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERROR","useProvideAuth","authUser","setAuthUser","error","setError","isLoadingUser","setLoadingUser","isLoading","setLoading","history","fetchStart","fetchSuccess","fetchError","userLogin","user","callbackFun","get","username","password","then","data","defaults","headers","common","access_token","localStorage","setItem","getAuthUser","catch","userSignup","post","message","sendPasswordResetEmail","setTimeout","confirmPasswordReset","code","renderSocialMediaLogin","userSignOut","removeItem","token","getItem","console","log"],"mappings":"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","sourcesContent":["import { useEffect, useState, useRef } from 'react';\nimport { httpClient } from \"../../../util/Api\";\nimport {useHistory} from \"react-router-dom\";\nimport jwtDecode from \"jwt-decode\";\nimport {\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGOUT,\n  CLEAR_ERROR,\n} from \"../../types\";\n\nexport const useProvideAuth = () => {\n  const [authUser, setAuthUser] = useState(null);\n  const [error, setError] = useState('');\n  const [isLoadingUser, setLoadingUser] = useState(true);\n  const [isLoading, setLoading] = useState(false);\n  // const [dataAuth, setDataAuth] = useState()\n  // const nRef = useRef(dataAuth);\n  const history = useHistory();\n  // console.log(\"authUser\",authUser )\n\n\n  // useEffect(() => { \n  //   nRef.current = dataAuth \n  // }, \n  //  [dataAuth]\n  //  ) \n// console.log(\"nRef\",nRef)\n\n  const fetchStart = () => {\n    setLoading(true);\n    setError('');\n  };\n\n  const fetchSuccess = () => {\n    setLoading(false);\n    setError('');\n  };\n\n  const fetchError = (error) => {\n    setLoading(false);\n    setError(error);\n  };\n\n  const userLogin = (user, callbackFun) => {\n    // console.log(\"user\", user)\n\n    // setDataAuth(user)\n    fetchStart();\n    httpClient\n      .get('login?username=' + user.username + '&password=' + user.password, user)\n      .then(({ data }) => {\n        if (data) {\n          fetchSuccess();\n          httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + data.access_token;\n          localStorage.setItem('token', data.access_token);\n          getAuthUser();\n          if (callbackFun) callbackFun();\n        } else {\n          fetchError(data.error);\n        }     \n        //  console.log(\"data.result\",data)\n\n      })\n      .catch(function (error) {\n        // fetchError(error.message);\n        fetchError(\"Username / Password Salah\");\n        \n      });\n  };\n\n  \n  const userSignup = (user, callbackFun) => {\n    fetchStart();\n    httpClient\n      .post('auth/register', user)\n      .then(({ data }) => {\n        if (data) {\n          fetchSuccess();\n          localStorage.setItem('token', data.access_token);\n          httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + data.access_token;\n          getAuthUser();\n          if (callbackFun) callbackFun();\n        } else {\n          fetchError(data.error);\n        }\n      })\n      .catch(function (error) {\n        fetchError(error.message);\n      });\n  };\n\n  const sendPasswordResetEmail = (username, callbackFun) => {\n    fetchStart();\n\n    setTimeout(() => {\n      fetchSuccess();\n      if (callbackFun) callbackFun();\n    }, 300);\n  };\n\n  const confirmPasswordReset = (code, password, callbackFun) => {\n    fetchStart();\n\n    setTimeout(() => {\n      fetchSuccess();\n      if (callbackFun) callbackFun();\n    }, 300);\n  };\n\n  const renderSocialMediaLogin = () => null;\n\n  const userSignOut = (callbackFun) => {\n    // const decoded = jwtDecode(localStorage.token);\n    // if (decoded.exp < Date.now() / 1000) {\n    //   // return dispatch({ type: AUTH_ERROR });\n    //   // console.log(\"dispatch\", AUTH_ERROR)\n    // }\n    fetchStart();\n    httpClient\n      .get('/logout')\n      .then(({ data }) => {\n        if (data) {\n          fetchSuccess();\n          httpClient.defaults.headers.common['Authorization'] = '';\n          localStorage.removeItem('token');\n          setAuthUser(false);\n          if (callbackFun) callbackFun();\n        } else {\n          fetchError(data.error);\n        }\n        // console.log(\"data logout 0000000000000000000\", data)\n      })\n      .catch(function (error) {\n        fetchError(error.message);\n      });\n      // history.push('/signin')\n      };\n\n\n  const getAuthUser = () => {\n    fetchStart();\n    httpClient\n      .get('/user')\n      .then(({ data }) => {\n        if (data) {\n          fetchSuccess();\n          setAuthUser(data);\n        } else {\n          fetchError(data.error);\n        }      \n        // console.log(\"data user\", data)\n\n      })\n      .catch(function (error) {\n        httpClient.defaults.headers.common['Authorization'] = '';\n        fetchError(error.message);\n      });\n  };\n\n  // Subscribe to user on mount\n  // Because this sets state in the callback it will cause any ...\n  // ... component that utilizes this hook to re-render with the ...\n  // ... latest auth object.\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    console.log(\"token\", token)\n        if (token) {\n        httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + token;\n      } else if (token === null) {\n        // localStorage.setItem('auth-token', '');\n        // token = '';\n        // setAuthUser(false);\n       return <div>Halaman Tidak ada</div>\n      }\n      httpClient\n        // .get('login?username=' + nRef.username + '&password=' + nRef.password, nRef)\n        .get('/user')\n        .then(({ data }) => {\n          if ( data) {\n            setAuthUser(data);\n          }\n          setLoadingUser(false);\n          console.log(\"data user USEEFFECT\", data)\n\n        })\n        .catch(function () {\n          localStorage.removeItem('token');\n          httpClient.defaults.headers.common['Authorization'] = '';\n          setLoadingUser(false);\n        })\n      \n  }, []);\n\n  // Return the user object and auth methods\n  return {\n    isLoadingUser,\n    isLoading,\n    authUser,\n    error,\n    setError,\n    setAuthUser,\n    getAuthUser,\n    userLogin,\n    userSignup,\n    userSignOut,\n    renderSocialMediaLogin,\n    sendPasswordResetEmail,\n    confirmPasswordReset,\n  };\n};"]},"metadata":{},"sourceType":"module"}